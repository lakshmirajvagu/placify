import{r,b as j,B as x,j as e,u as z,d as G}from"./index-BW9J8XDZ.js";import{A as h}from"./Accordion-QbAzgRVx.js";import{F as p,a as g}from"./Form-B79OQcrp.js";import{C as V}from"./Toast-B3EGjjVm.js";import{M as Q}from"./Modal-C3czwkNW.js";import{P as W,L as X}from"./index-K0BZtk2v.js";import{B as Y}from"./Button-DwHs9q8a.js";import"./ThemeProvider-CkxvoxuK.js";import"./hook-DYghO068.js";import"./TransitionWrapper-C8SpBI9G.js";import"./useTimeout-C4AjoZ0W.js";import"./Col-ybKDMb82.js";import"./useEventCallback-Duh4GctK.js";import"./hasClass-Cxr2nBO8.js";import"./iconBase-URH_NpeO.js";import"./Button-2RoaZ0va.js";const Z=({jobId:S,fetchJobDetailsOfApplicant:m})=>{const[o,y]=r.useState(""),[v,E]=r.useState({id:"",role:""});r.useEffect(()=>{const f=localStorage.getItem("token");j.get(`${x}/user/detail`,{headers:{Authorization:`Bearer ${f}`}}).then(t=>{E({id:t.data.id,role:t.data.role})}).catch(t=>{console.log("UploadResume.jsx => ",t)})},[]);const a=async f=>{if(f.preventDefault(),!f.target.files[0]){y("Please select a file");return}const t=new FormData;t.append("offerLetter",f.target.files[0]),t.append("studentId",v.id),t.append("jobId",S);try{const C=await j.post(`${x}/student/upload-offer-letter`,t,{headers:{"Content-Type":"multipart/form-data"}});y("Offer letter uploaded successfully"),m&&m()}catch(C){console.error("Error uploading the offer letter",C),y("Error uploading the offer letter")}};return e.jsx(e.Fragment,{children:e.jsxs(p,{controlId:"floatingOfferLetter",label:"Upload Offer Letter",children:[e.jsx(g.Control,{type:"file",accept:".pdf, .doc, .docx",placeholder:"Upload Offer Letter",name:"offerLetter",onChange:a}),o&&e.jsx("p",{className:"text-sm text-gray-300 mt-1",children:o})]})})};function xe(){document.title="CPMS | Update Job Application Status";const S=z(),{jobId:m}=G(),[o,y]=r.useState({}),[v,E]=r.useState(null),[a,f]=r.useState({}),[t,C]=r.useState({}),[$,F]=r.useState(!0),[T,c]=r.useState(!1),[M,u]=r.useState(""),[P,L]=r.useState(!1),[_,D]=r.useState(!1),[B,I]=r.useState(!1),J=()=>D(!1);r.useEffect(()=>{const s=localStorage.getItem("token");j.get(`${x}/user/detail`,{headers:{Authorization:`Bearer ${s}`}}).then(n=>{C({id:n.data.id,first_name:n.data.first_name,middle_name:n.data.middle_name,last_name:n.data.last_name,email:n.data.email,number:n.data.number,role:n.data.role,uin:n.data.studentProfile.uin})}).catch(n=>{console.log("AddUserTable.jsx => ",n),u(n),c(!0)})},[]);const k=async()=>{var s,n,d;try{const i=await j.get(`${x}/tpo/job/${m}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});y(i.data)}catch(i){i.response&&((s=i==null?void 0:i.response.data)!=null&&s.msg?u(i.response.data.msg):u(i.message),c(!0),((d=(n=i==null?void 0:i.response)==null?void 0:n.data)==null?void 0:d.msg)==="job data not found"&&S("../404")),console.log("Error while fetching details => ",i)}},O=async()=>{try{const s=await j.get(`${x}/company/company-data?companyId=${o.company}`);E(s.data.company)}catch(s){console.log("AddCompany error while fetching => ",s)}},A=async()=>{var s;if(((s=o==null?void 0:o.applicants)==null?void 0:s.length)!==0){const n=await o.applicants.find(d=>d.studentId===t.id);n?f(n):S("../404"),n.status==="hired"&&I(!0)}},H=async()=>{var s,n,d,i,N,w;if((a==null?void 0:a.status)==="hired"&&!(a!=null&&a.package)){u("Package Offered Required!"),c(!0);return}try{const l=await j.post(`${x}/student/update-status/${m}/${t.id}`,{applicant:a});(s=l==null?void 0:l.data)!=null&&s.msg&&(u((n=l==null?void 0:l.data)==null?void 0:n.msg),c(!0))}catch(l){(i=(d=l==null?void 0:l.response)==null?void 0:d.data)!=null&&i.msg&&(u((w=(N=l==null?void 0:l.response)==null?void 0:N.data)==null?void 0:w.msg),c(!0)),console.log("Error while update job status => ",l)}};r.useEffect(()=>{(async()=>{try{await k(),o!=null&&o.company&&await O(),o!=null&&o.applicants&&(t!=null&&t.id)&&await A(),a.status==="hired"&&I(!0),F(!1)}catch(n){u("Error during fetching and applying job"),c(!0),console.error("Error during fetching and applying job:",n)}})()},[t==null?void 0:t.id,o==null?void 0:o.company,m]);const b=s=>{f({...a,[s.target.name]:s.target.value}),s.target.name==="status"&&s.target.value==="hired"&&I(!0),s.target.name==="status"&&s.target.value!=="hired"&&I(!1)},R=s=>!s||s==="undefined"?"":new Date(s).toISOString().split("T")[0],q=()=>D(!0),K=async()=>{var s,n,d,i,N,w;try{const l=await j.post(`${x}/student/delete-offer-letter/${m}/${t.id}`,{applicant:a});(s=l==null?void 0:l.data)!=null&&s.msg&&(u((n=l==null?void 0:l.data)==null?void 0:n.msg),c(!0),D(!1),await k(),await A())}catch(l){(i=(d=l==null?void 0:l.response)==null?void 0:d.data)!=null&&i.msg&&(u((w=(N=l==null?void 0:l.response)==null?void 0:N.data)==null?void 0:w.msg),c(!0)),D(!1),console.log("Error while update job status => ",l)}};return e.jsxs(e.Fragment,{children:[e.jsx(V,{show:T,onClose:()=>c(!1),message:M,delay:3e3,position:"bottom-end"}),$?e.jsx("div",{className:"flex justify-center h-72 items-center",children:e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-3xl"})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-2 my-6 text-base max-sm:grid-cols-1 max-sm:text-sm",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("div",{className:"",children:e.jsx(h,{defaultActiveKey:["0"],alwaysOpen:!0,className:"shadow rounded w-full max-sm:w-fit",children:e.jsxs(h.Item,{eventKey:"0",children:[e.jsx(h.Header,{children:"Basic Details"}),e.jsx(h.Body,{children:e.jsx("div",{className:"",children:e.jsx("div",{className:"flex flex-col justify-between py-2",children:e.jsx("div",{className:"flex justify-between",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-700 font-bold",children:"Full Name: "}),e.jsxs("span",{className:"text-blue-500 font-bold",children:[(t==null?void 0:t.first_name)+" ",(t==null?void 0:t.middle_name)&&(t==null?void 0:t.middle_name)+" ",t==null?void 0:t.last_name]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-700 font-bold",children:"Email: "}),e.jsx("span",{className:"text-blue-500 font-bold",children:t==null?void 0:t.email})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-700 font-bold",children:"Number: "}),e.jsx("span",{className:"text-blue-500 font-bold",children:t==null?void 0:t.number})]}),(t==null?void 0:t.uin)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-700 font-bold",children:"UIN: "}),e.jsx("span",{className:"text-blue-500 font-bold",children:t==null?void 0:t.uin})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-700 font-bold",children:"Company Name: "}),e.jsx("span",{className:"text-blue-500 font-bold",children:v==null?void 0:v.companyName})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-700 font-bold",children:"Job Title: "}),e.jsx("span",{className:"text-blue-500 font-bold",children:o==null?void 0:o.jobTitle})]})]})})})})})]})})})}),e.jsx("div",{className:"",children:e.jsx(h,{defaultActiveKey:["1"],alwaysOpen:!0,className:"shadow rounded w-full max-sm:w-fit",children:e.jsxs(h.Item,{eventKey:"1",children:[e.jsx(h.Header,{children:"Job Details"}),e.jsx(h.Body,{children:e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 max-sm:grid-cols-1",children:[e.jsx(p,{controlId:"floatingSelectCurrentRound",label:"Current Round",children:e.jsxs(g.Select,{"aria-label":"Floating label select current round",className:"cursor-pointer",name:"currentRound",value:(a==null?void 0:a.currentRound)||"undefined",onChange:b,children:[e.jsx("option",{disabled:!0,value:"undefined",className:"text-gray-400",children:"Enter Current Round"}),e.jsx("option",{value:"Aptitude Test",children:"Aptitude Test"}),e.jsx("option",{value:"Technical Interview",children:"Technical Interview"}),e.jsx("option",{value:"HR Interview",children:"HR Interview"}),e.jsx("option",{value:"Group Discussion",children:"Group Discussion"})]})}),e.jsx(p,{controlId:"floatingSelectRoundStatus",label:"Round Status",children:e.jsxs(g.Select,{"aria-label":"Floating label select round status",className:"cursor-pointer",name:"roundStatus",value:(a==null?void 0:a.roundStatus)||"undefined",onChange:b,children:[e.jsx("option",{disabled:!0,value:"undefined",className:"text-gray-400",children:"Enter Round Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"passed",children:"Passed"}),e.jsx("option",{value:"failed",children:"Failed"})]})}),e.jsx(p,{controlId:"floatingSelectionDate",label:"Selection Date",children:e.jsx(g.Control,{type:"date",placeholder:"Selection Date",name:"selectionDate",value:R(a==null?void 0:a.selectionDate),onChange:b})}),e.jsx(p,{controlId:"floatingJoiningDate",label:"Joining Date",children:e.jsx(g.Control,{type:"date",placeholder:"Joining Date",name:"joiningDate",value:R(a==null?void 0:a.joiningDate),onChange:b})}),e.jsxs("div",{className:"flex flex-col gap-2 justify-center items-center",children:[e.jsx(Z,{jobId:m,fetchJobDetailsOfApplicant:A}),(a==null?void 0:a.offerLetter)&&e.jsxs("div",{className:"cursor-pointer w-fit flex gap-1 justify-between items-center",children:[e.jsx("span",{className:"bg-blue-500 px-3 py-1 rounded transition duration-300 ease-in-out hover:bg-blue-700",onMouseEnter:()=>L(!0),onMouseLeave:()=>L(!1),children:e.jsxs("a",{className:"text-white no-underline flex justify-center items-center",target:"_blanck",href:x+(a==null?void 0:a.offerLetter),children:[P?e.jsx(W,{className:"pr-2 text-3xl"}):e.jsx(X,{className:"pr-2 text-3xl"}),"View Now"]})}),e.jsxs("span",{className:"text-white bg-red-500 px-3 py-1 rounded transition-all duration-200 hover:bg-red-700",onClick:q,onMouseEnter:s=>{const n=s.target.querySelector("i");n.classList.remove("fa-regular"),n.classList.add("fa-solid")},onMouseLeave:s=>{const n=s.target.querySelector("i");n.classList.add("fa-regular"),n.classList.remove("fa-solid")},children:[e.jsx("i",{className:"fa-regular fa-trash-can pr-2 py-1 text-lg"}),"Delete"]})]})]}),e.jsx(p,{controlId:"floatingSelectJobStatus",label:"Job Status",children:e.jsxs(g.Select,{"aria-label":"Floating label select job status",className:"cursor-pointer",name:"status",value:(a==null?void 0:a.status)||"undefined",onChange:b,children:[e.jsx("option",{disabled:!0,value:"undefined",className:"text-gray-400",children:"Enter Job Status"}),e.jsx("option",{value:"applied",children:"Applied"}),e.jsx("option",{value:"interview",children:"Interview"}),e.jsx("option",{value:"hired",children:"Hired"}),e.jsx("option",{value:"rejected",children:"Rejected"})]})}),B===!0&&e.jsx("div",{className:"col-span-2",children:e.jsx(p,{controlId:"floatingPackage",label:e.jsx(e.Fragment,{children:e.jsxs("span",{children:["Enter Package Offered ",e.jsx("span",{className:"text-red-500",children:"*"})]})}),children:e.jsx(g.Control,{type:"number",step:.01,placeholder:"Enter Package Offered",name:"package",value:a==null?void 0:a.package,onChange:b,required:!0})})})]}),e.jsx("div",{className:"mb-2 mt-3",children:e.jsxs(Y,{variant:"primary",onClick:H,children:[e.jsx("i",{className:"fa-solid fa-floppy-disk pr-2"}),"Update"]})})]})})]})})})]})}),e.jsx(Q,{show:_,close:J,header:"Confirmation",body:"Do you want to delete offer letter?",btn:"Delete",confirmAction:K})]})}export{xe as default};
