import{u as T,r as a,b as p,B as f,j as e}from"./index-BW9J8XDZ.js";import{B as E}from"./Button-DwHs9q8a.js";import{F as d,a as m}from"./Form-B79OQcrp.js";import{C as B}from"./Toast-B3EGjjVm.js";import{M as F}from"./Modal-C3czwkNW.js";import"./ThemeProvider-CkxvoxuK.js";import"./Button-2RoaZ0va.js";import"./useTimeout-C4AjoZ0W.js";import"./TransitionWrapper-C8SpBI9G.js";import"./Col-ybKDMb82.js";import"./useEventCallback-Duh4GctK.js";import"./hasClass-Cxr2nBO8.js";function G(){document.title="CPMS | Send Notice";const n=T(),[u,j]=a.useState(!0),[s,g]=a.useState({}),[h,S]=a.useState(""),[t,v]=a.useState({role:"",id:""}),[b,x]=a.useState(!1),[N,y]=a.useState(""),[C,r]=a.useState(!1),M=()=>r(!1);a.useEffect(()=>{const o=localStorage.getItem("token");if(!o){n("/login");return}p.get(`${f}/user/detail`,{headers:{Authorization:`Bearer ${o}`}}).then(i=>{v({id:i.data.id,role:i.data.role}),j(!1)}).catch(i=>{console.log("SendNotice.jsx => ",i),n("/login")})},[n]);const c=o=>g({...s,[o.target.name]:o.target.value}),w=()=>{if(!(s!=null&&s.receiver_role)&&!(s!=null&&s.title)&&!(s!=null&&s.message)){S("All Fields Required!");return}r(!0)},_=async()=>{var o,i;try{const l=await p.post(`${f}/management/send-notice`,s,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});(o=l==null?void 0:l.data)!=null&&o.msg&&(y((i=l==null?void 0:l.data)==null?void 0:i.msg),x(!0)),n((t==null?void 0:t.role)==="management_admin"?"/management/all-notice":"/tpo/all-notice")}catch(l){console.log("Error while sending notice: ",l)}r(!1)};return a.useEffect(()=>{t!=null&&t.role&&(t!=null&&t.id)&&g(o=>({...o,sender:t==null?void 0:t.id,sender_role:t==null?void 0:t.role}))},[t]),e.jsxs(e.Fragment,{children:[e.jsx(B,{show:b,onClose:()=>x(!1),message:N,delay:3e3,position:"bottom-end"}),u?e.jsx("div",{className:"flex justify-center h-72 items-center",children:e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-3xl"})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"my-8 backdrop-blur-md bg-white/30 border border-white/20 rounded-lg shadow shadow-red-400 p-6 max-sm:text-sm max-sm:p-3",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[(t==null?void 0:t.role)==="management_admin"&&e.jsx(d,{controlId:"floatingSendTo",label:e.jsxs("span",{children:["Receiver Role ",e.jsx("span",{style:{color:"red"},children:"*"})]}),children:e.jsxs(m.Select,{"aria-label":"Floating label select send to",className:"cursor-pointer",name:"receiver_role",value:(s==null?void 0:s.receiver_role)||"",onChange:c,children:[e.jsx("option",{disabled:!0,value:"",className:"text-gray-400",children:"Select Receiver Role..."}),e.jsx("option",{value:"student",children:"Student"}),e.jsx("option",{value:"tpo_admin",children:"TPO"})]})}),e.jsx(d,{controlId:"floatingTitle",label:e.jsxs("span",{children:["Title ",e.jsx("span",{style:{color:"red"},children:"*"})]}),className:(t==null?void 0:t.role)==="tpo_admin"?"col-span-2":"",children:e.jsx(m.Control,{type:"text",placeholder:"Title",name:"title",value:(s==null?void 0:s.title)||"",onChange:c})}),e.jsx("div",{className:"col-span-2",children:e.jsx(d,{controlId:"floatingMessage",label:e.jsxs("span",{children:["Message ",e.jsx("span",{style:{color:"red"},children:"*"})]}),children:e.jsx(m.Control,{as:"textarea",placeholder:"Message",name:"message",style:{maxHeight:"250px",height:"200px"},value:(s==null?void 0:s.message)||"",onChange:c})})})]}),e.jsx("div",{className:"mt-2",children:e.jsx("span",{className:"text-center text-red-500",children:h&&h})})]}),e.jsx("div",{className:"flex flex-col justify-center items-center gap-2",children:e.jsxs(E,{variant:"primary",size:"lg",onClick:w,onMouseEnter:o=>{o.target.querySelector("i").classList.add("fa-solid","fa-bounce")},onMouseLeave:o=>{o.target.querySelector("i").classList.remove("fa-solid","fa-bounce")},children:[e.jsx("i",{className:"fa-regular fa-paper-plane mr-2"}),"Send"]})})]})}),e.jsx(F,{show:C,close:M,header:"Confirmation",body:`Sending Notice ${s!=null&&s.message?`"${s==null?void 0:s.message}"`:""} to ${(s==null?void 0:s.receiver_role)||"student"}?`,btn:"Send",confirmAction:_})]})}export{G as default};
