import{u as R,a as q,r as o,b as x,B as u,j as e}from"./index-BW9J8XDZ.js";import{T as H}from"./Table-BMev4Dnk.js";import{P as $}from"./Placeholder-lanV48h9.js";import{T as V,O as y,a as N}from"./TablePlaceholder-Ble8dsBU.js";import{M as G}from"./Modal-C3czwkNW.js";import{C as K}from"./Toast-B3EGjjVm.js";import"./ThemeProvider-CkxvoxuK.js";import"./Col-ybKDMb82.js";import"./Button-DwHs9q8a.js";import"./Button-2RoaZ0va.js";import"./hasClass-Cxr2nBO8.js";import"./TransitionWrapper-C8SpBI9G.js";import"./useEventCallback-Duh4GctK.js";import"./useTimeout-C4AjoZ0W.js";import"./hook-DYghO068.js";function ce(){document.title="CPMS | Job Listings";const g=R(),M=q(),[_,w]=o.useState(!0),[c,j]=o.useState([]),[v,A]=o.useState({}),[m,E]=o.useState(null),[k,d]=o.useState(!1),[D,h]=o.useState(""),[I,f]=o.useState(!1),[J,S]=o.useState(null),[r,L]=o.useState({cmpName:"",jbTitle:""});o.useEffect(()=>{const t=localStorage.getItem("token");x.get(`${u}/user/detail`,{headers:{Authorization:`Bearer ${t}`}}).then(s=>{E({id:s.data.id,email:s.data.email,role:s.data.role}),T()}).catch(s=>{console.log("Error in fetching user details => ",s),h(s.message||"Error loading user data"),d(!0)})},[]);const T=async()=>{var t,s;try{const a=await x.get(`${u}/tpo/jobs`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});j(a.data.data),F(a.data.data)}catch(a){console.log("Error fetching jobs ",a),(s=(t=a==null?void 0:a.response)==null?void 0:t.data)!=null&&s.msg&&(h(a.response.data.msg),d(!0))}},F=async t=>{const s={};for(const a of t)if(a.company&&!s[a.company])try{const l=await x.get(`${u}/company/company-data?companyId=${a.company}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});s[a.company]=l.data.company.companyName}catch(l){console.log("Error fetching company name => ",l)}A(s),w(!1)},z=(t,s,a)=>{S(t),L({cmpName:s,jbTitle:a}),f(!0)},B=async t=>{var s,a,l,p,i,C;try{const n=await x.post(`${u}/tpo/delete-job`,{jobId:t});f(!1),T(),(s=n==null?void 0:n.data)!=null&&s.msg&&(h((a=n==null?void 0:n.data)==null?void 0:a.msg),d(!0))}catch(n){(p=(l=n==null?void 0:n.response)==null?void 0:l.data)!=null&&p.msg&&(h((C=(i=n==null?void 0:n.response)==null?void 0:i.data)==null?void 0:C.msg),d(!0)),console.log("Error deleting job ",n)}},U=()=>{f(!1),S(null)},{showToastPass:P,toastMessagePass:O}=M.state||{showToastPass:!1,toastMessagePass:""};return o.useEffect(()=>{P&&(h(O),d(P),g(".",{replace:!0,state:{}})),c||w(!1)},[]),e.jsxs(e.Fragment,{children:[e.jsx(K,{show:k,onClose:()=>d(!1),message:D,delay:3e3,position:"bottom-end"}),e.jsx("div",{className:"",children:_||!m?e.jsx(V,{}):e.jsx("div",{className:"overflow-x-auto max-sm:text-sm max-sm:p-1",children:e.jsx("div",{className:"table-scrollbar",children:e.jsxs(H,{striped:!0,bordered:!0,hover:!0,className:"bg-white my-6 rounded-lg shadow w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Sr. No."}),e.jsx("th",{children:e.jsx("b",{children:"Company Name"})}),e.jsx("th",{children:"Job Title"}),e.jsx("th",{children:"Annual CTC"}),e.jsx("th",{children:"Last date of Application"}),e.jsx("th",{children:"No. of Students Applied"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:(c==null?void 0:c.length)>0?c==null?void 0:c.map((t,s)=>{var l,p;const a=(l=t==null?void 0:t.applicants)==null?void 0:l.find(i=>i.studentId==m.id);return e.jsxs("tr",{className:`${a?"table-success":""}`,children:[e.jsx("td",{children:s+1}),e.jsx("td",{children:e.jsx("b",{children:v[t==null?void 0:t.company]||e.jsx($,{as:"p",animation:"glow",children:e.jsx($,{xs:12})})})}),e.jsx("td",{children:t==null?void 0:t.jobTitle}),e.jsx("td",{children:t==null?void 0:t.salary}),e.jsx("td",{children:new Date(t==null?void 0:t.applicationDeadline).toLocaleDateString("en-In")}),e.jsx("td",{children:(p=t==null?void 0:t.applicants)==null?void 0:p.length}),e.jsx("td",{children:e.jsxs("div",{className:"flex justify-around items-center",children:[e.jsx("div",{className:"px-0.5",children:e.jsx(y,{placement:"top",delay:{show:250,hide:400},overlay:e.jsx(N,{children:"View Post"}),children:e.jsx("i",{className:"fa-solid fa-circle-info text-2xl max-sm:text-lg cursor-pointer transition-colors duration-200 ease-in-out hover:text-blue-500",onClick:()=>{const i={tpo_admin:`../tpo/job/${t._id}`,management_admin:`../management/job/${t._id}`,superuser:`../admin/job/${t._id}`,student:`../student/job/${t._id}`};g(i[m.role])}})})}),m.role!=="student"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-0.5",children:e.jsx(y,{placement:"top",delay:{show:250,hide:400},overlay:e.jsx(N,{children:"Edit Post"}),children:e.jsx("i",{className:"fa-regular fa-pen-to-square text-2xl max-sm:text-lg cursor-pointer transition-colors duration-200 ease-in-out hover:text-green-500 hover:fa-solid",onClick:()=>{const i={tpo_admin:`../tpo/post-job/${t._id}`,management_admin:`../management/post-job/${t._id}`,superuser:`../admin/post-job/${t._id}`};g(i[m.role])}})})}),e.jsx("div",{className:"px-0.5",children:e.jsx(y,{placement:"top",delay:{show:250,hide:400},overlay:e.jsx(N,{children:"Delete Post"}),children:e.jsx("i",{className:"fa-regular fa-trash-can text-2xl max-sm:text-lg cursor-pointer transition-colors duration-200 ease-in-out hover:text-red-500 hover:fa-solid",onClick:()=>z(t==null?void 0:t._id,v[t==null?void 0:t.company],t==null?void 0:t.jobTitle)})})})]})]})})]},t==null?void 0:t._id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center",children:"No Job Posts Found!"})})})]})})})}),e.jsx(G,{show:I,modalHeader:`Confirm Delete ${r==null?void 0:r.cmpName}`,modalBody:e.jsxs(e.Fragment,{children:["Are you sure you want to delete this post of ",e.jsx("b",{children:r==null?void 0:r.jbTitle})," from ",r==null?void 0:r.cmpName,"?"]}),modalActions:e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-secondary",onClick:U,children:"Cancel"}),e.jsx("button",{className:"btn btn-danger",onClick:()=>B(J),children:"Delete"})]})})]})}export{ce as default};
