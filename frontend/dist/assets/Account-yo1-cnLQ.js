import{r as u,j as e,b as x,B as f}from"./index-BW9J8XDZ.js";import{c as B}from"./index-1TJ_vit0.js";import{R as _}from"./index-BgyV-MeX.js";import{F as D}from"./index-BY9Ksho_.js";import{a as l,F as o}from"./Form-B79OQcrp.js";import{C as M}from"./Toast-B3EGjjVm.js";import"./iconBase-URH_NpeO.js";import"./ThemeProvider-CkxvoxuK.js";import"./useTimeout-C4AjoZ0W.js";import"./TransitionWrapper-C8SpBI9G.js";import"./Col-ybKDMb82.js";import"./useEventCallback-Duh4GctK.js";function K(){var C,v;document.title="CPMS | Account";const[s,h]=u.useState({}),[N,w]=u.useState(!0),g=async()=>{try{const a=localStorage.getItem("token"),n=await x.get(`${f}/user/detail`,{headers:{Authorization:`Bearer ${a}`}});h(n.data),w(!1)}catch(a){console.log("Account.jsx => ",a),w(!1)}},d=a=>h({...s,[a.target.name]:a.target.value}),b=async a=>{var n;a.preventDefault();try{const r=localStorage.getItem("token"),m=await x.post(`${f}/user/update-profile`,s,{headers:{Authorization:`Bearer ${r}`}});c(m.data.msg),i(!0)}catch(r){(n=r==null?void 0:r.response.data)!=null&&n.msg?c(r.response.data.msg):c(r.message),i(!0),console.log("handleBasicDetailSubmit => ",r)}finally{g()}},y=async a=>{const n=a.target.files[0];if(n){const r=new FormData;r.append("profileImgs",n),r.append("userId",s.id);try{const m=await x.post(`${f}/user/upload-photo`,r);c(m.data.msg),i(!0)}catch(m){c(m.message),i(!0),console.error("Error uploading photo:",m)}finally{console.log("runnned"),g()}}},[A,i]=u.useState(!1),[S,c]=u.useState(""),[t,p]=u.useState({oldpass:"",newpass:"",newcfmpass:"",error:""});function P(a){return/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/.test(a)}const j=a=>{p({...t,[a.target.name]:a.target.value})},F=async a=>{if(a.preventDefault(),!t.oldpass||!t.newpass||!t.newcfmpass)return p({...t,error:"All Field Requied!"});if(!P(t==null?void 0:t.newpass))return p({...t,error:"Password Must Contains: Minimum 8 Char with atleast 1 Special Char, 1 Number, 1 Uppercase, 1 Lowercase"});if(t.newpass!=t.newcfmpass)return p({...t,error:"New Password & Confirm New Password Didn't Matched"});try{const n=localStorage.getItem("token"),r=await x.post(`${f}/user/change-password`,t,{headers:{Authorization:`Bearer ${n}`}});r!=null&&r.data&&(c(r==null?void 0:r.data),i(!0))}catch(n){console.log("Account.jsx updatepass =>",n),p({...t,error:n.message})}finally{g()}},I=a=>!a||a==="undefined"?"":new Date(a).toISOString().split("T")[0];return u.useEffect(()=>{g()},[]),e.jsx(e.Fragment,{children:N?e.jsx("div",{className:"flex justify-center h-72 items-center",children:e.jsx("i",{className:"fa-solid fa-spinner fa-spin text-3xl"})}):e.jsxs(e.Fragment,{children:[e.jsx(M,{show:A,onClose:()=>i(!1),message:S,delay:3e3,position:"bottom-end"}),e.jsx("div",{className:"max-sm:text-sm text-base",children:e.jsxs("div",{className:"container grid grid-cols-3 gap-3 p-4 max-lg:grid-cols-2 max-sm:grid-cols-1",children:[e.jsx("div",{className:"col-span-2 bg-white p-6 rounded-lg shadow-md w-full",children:e.jsxs(l,{onSubmit:b,children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2  justify-center items-start",children:[e.jsx(o,{label:"First Name",children:e.jsx(l.Control,{type:"text",autoComplete:"first_name",placeholder:"First Name",name:"first_name",value:s.first_name||"",onChange:d,required:!0})}),e.jsx(o,{label:"Middle Name",children:e.jsx(l.Control,{type:"text",autoComplete:"middle_name",placeholder:"Middle Name",name:"middle_name",value:s.middle_name||"",onChange:d,required:!0})}),e.jsx(o,{label:"Last Name",children:e.jsx(l.Control,{type:"text",autoComplete:"last_name",placeholder:"Last Name",name:"last_name",value:s.last_name||"",onChange:d,required:!0})}),e.jsx(o,{label:"Number",children:e.jsx(l.Control,{type:"number",autoComplete:"number",placeholder:"Number",name:"number",value:s.number||"",onChange:d,onInput:a=>{a.target.value.length>10&&(a.target.value=a.target.value.slice(0,10))},required:!0})}),e.jsx("div",{className:"col-span-2",children:e.jsx(o,{label:"Email",children:e.jsx(l.Control,{type:"email",autoComplete:"email",placeholder:"Email",name:"email",value:s.email||"",onChange:d,required:!0})})}),e.jsx(o,{controlId:"floatingBirthDate",label:"Date of Birth",children:e.jsx(l.Control,{type:"date",placeholder:"Date of Birth",name:"dateOfBirth",value:I(s==null?void 0:s.dateOfBirth),onChange:d,required:!0})}),e.jsx(o,{controlId:"floatingSelectGender",label:"Gender",children:e.jsxs(l.Select,{"aria-label":"Floating label select gender",className:"cursor-pointer",name:"gender",value:(s==null?void 0:s.gender)===void 0?"undefined":s==null?void 0:s.gender,onChange:d,children:[e.jsx("option",{disabled:!0,value:"undefined",className:"text-gray-400",children:"Enter Your Gender"}),e.jsx("option",{value:"Male",children:"Male"}),e.jsx("option",{value:"Female",children:"Female"}),e.jsx("option",{value:"Other",children:"Other"})]})})]}),e.jsxs("button",{type:"submit",className:"flex items-center my-2 px-3 py-2 bg-blue-500 text-white rounded",children:[e.jsx(B,{className:"mr-2"}),"Save"]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md w-full max-sm:col-span-2",children:e.jsxs(l,{onSubmit:b,children:[e.jsxs("div",{className:"grid gap-2 ",children:[e.jsx(o,{className:"w-full",controlId:"floatingTextareaAddress",label:"Address",children:e.jsx(l.Control,{as:"textarea",placeholder:"Enter Full Address here...",style:{height:"150px",resize:"none"},name:"address",value:(C=s==null?void 0:s.fullAddress)==null?void 0:C.address,onChange:a=>{h({...s,fullAddress:{...s==null?void 0:s.fullAddress,address:a.target.value}})},required:!0})}),e.jsx(o,{controlId:"floatingAddressPincode",label:"Pincode",children:e.jsx(l.Control,{type:"number",placeholder:"Pincode",maxLength:6,name:"pincode",value:(v=s==null?void 0:s.fullAddress)==null?void 0:v.pincode,onChange:a=>{h({...s,fullAddress:{...s==null?void 0:s.fullAddress,pincode:a.target.value}})},pattern:"\\d{6}",onInput:a=>{a.target.value.length>6&&(a.target.value=a.target.value.slice(0,6))},required:!0})})]}),e.jsxs("button",{type:"submit",className:"flex items-center my-2 px-3 py-2 bg-blue-500 text-white rounded",children:[e.jsx(D,{className:"mr-2"}),"Change Address"]})]})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md w-full max-sm:col-span-2",children:e.jsx("div",{className:"",children:e.jsxs(l,{className:"flex flex-col justify-center items-center gap-3 text-center",children:[e.jsx("img",{src:s.profile,alt:"Profile Img",width:"150",height:"150",className:"rounded-full"}),e.jsxs(l.Group,{controlId:"formFile",className:"mb-3 text-xl",onChange:y,children:[e.jsx(l.Label,{children:s.first_name+" "+s.middle_name+" "+s.last_name}),e.jsx(l.Control,{type:"file",accept:".jpg, .jpeg, .png"})]})]})})}),e.jsx("div",{className:"bg-white p-6 rounded-lg shadow-md w-full col-span-2",children:e.jsxs(l,{onSubmit:F,children:[e.jsxs("div",{className:"grid gap-2 ",children:[e.jsx(o,{label:"Current Password",children:e.jsx(l.Control,{type:"password",autoComplete:"password",placeholder:"Password",name:"oldpass",value:t.oldpass||"",onChange:j})}),e.jsx(o,{label:"New Password",children:e.jsx(l.Control,{type:"password",autoComplete:"password",placeholder:"New Password",name:"newpass",value:t.newpass||"",onChange:j})}),e.jsx(o,{label:"Confirm New Password",children:e.jsx(l.Control,{type:"password",autoComplete:"password",placeholder:"Confirm New Password",name:"newcfmpass",value:t.newcfmpass||"",onChange:j})})]}),(t==null?void 0:t.error)&&e.jsx("div",{className:"",children:e.jsx("span",{className:"text-red-500",children:t==null?void 0:t.error})}),e.jsxs("button",{type:"submit",className:"flex items-center my-2 px-3 py-2 bg-blue-500 text-white rounded",children:[e.jsx(_,{className:"mr-2"}),"Change Password"]})]})})]})})]})})}export{K as default};
